<!doctype html>
<html>
<head>
	<meta charset='UTF-8' />
	<style>
		input, textarea {border:1px solid #CCC;margin:0px;padding:0px}

		#body {max-width:800px;margin:auto}
		#log {width:100%;height:200px}
		#message {width:100%;line-height:20px}
	</style>
	<script src="https://cdn.tinymce.com/4/tinymce.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script src="fancywebsocket.js"></script>
	<script>
		var Server;
		

		function send(text) {
			Server.send( 'message', text );
		}

		$(document).ready(function() {
			Server = new FancyWebSocket('ws://127.0.0.1:9300');
			tinymce.init({
				selector:"#editor",
				setup: function(ed) {
				    ed.on("change", function(e) {
				        console.log("change");
				        send(ed.getContent());
				    });
				    ed.on("keyup", function(e) {
				        console.log("keyup");
				        send(ed.getContent());
				    });
				}
			});

			// Let the user know we're connected
			Server.bind('open', function() {
				// connected
				console.log("CONNECTED");
			});

			// Disconnection occurred.
			Server.bind('close', function(data) {
				// disconnected
				console.log("DISCONNECTED");
			});

			// Log any messages sent from server
			Server.bind('message', function(payload) {
				tinymce.activeEditor.setContent(payload);
			});

			Server.connect();
		});
	</script>
</head>

<body>
	<textarea id="editor"></textarea>
	
</body>

</html>